<!DOCTYPE html>
<html lang="en"><head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Google Font -->
    <link rel="stylesheet" href="https://use.typekit.net/vhi7kwp.css">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.css">
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"> -->

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/headerfooterstyle.css">
    <link rel="stylesheet" href="/css/indexstyle.css">
    <link rel="stylesheet" href="/css/aboutstyle.css">
    <!-- <link rel="stylesheet" href="assets/main.scss"> -->

    <title>Fractal</title>
    <link rel="icon" type="image/png" href="/imgs/favicon2.png">

    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
          processEscapes: true,
        },
        "HTML-CSS": { availableFonts: ["TeX"] },
        }
        );
    </script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
</head><body><!-- NAVBAR -->
<nav id="mainNavbar" class="navbar navbar-dark navbar-expand-md py-0 fixed-top">
    <a class="navbar-brand" href="/index.html">
        <img src="/imgs/logo.png" id="logo-img" style="padding: 5px;">
    </a>
    <button class="navbar-toggler navbar-toggler-right" data-toggle="collapse" data-target="#navLinks" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navLinks">
        <ul class="nav navbar-nav ml-auto">
            <li class="nav-item">
                <a href="/content.html" class="nav-link">Content</a>
            </li>
            <li class="nav-item">
                <a href="/about.html" class="nav-link">About Us</a>
            </li>
            <!-- <li class="nav-item">
                <a href="calendar.html" class="nav-link">Events</a>
            </li>
            <li class="nav-item">
                <a href="sponsors.html" class="nav-link">Sponsor Us</a>
            </li>
            <li class="nav-item">
                <a href="current_members.html" class="nav-link">Alumni</a>
            </li> -->
            <li class="nav-item">
                <a href="/incoming_new.html">
                    <button class="btn btn-outline-success my-2 my-sm-0 nav-apply-btn" type="submit">Apply</button>
                </a>
            </li>
        </ul>
    </div>
</nav><article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">A2C and PPO</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2020-04-12T04:06:43-04:00" itemprop="datePublished">Apr 12, 2020
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p align="justify">In this guide, I'll be explaining a couple of more advanced methods of reinforcement learning; namely Advantage Actor Critic (A2C) and Proximal Policy Optimization (PPO), but first a recap of actor critic methods.</p>

<h3 id="recap-of-actor-critic">Recap of Actor Critic</h3>

<p>Recall computing the policy gradient</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
\nabla_{\theta}J(\theta) &= \mathbb{E}_{\tau \sim \pi_{\theta}}[\nabla_{\theta}\log{\pi_{\theta}(\tau)}R(\tau)] \\
&= \Big(\sum_{t=0}^{T - 1}\nabla_{\theta}\log{\pi_{\theta}(a_{t}|s_{t})}\Big) \cdot \sum_{t=0}^{T - 1} r_{t}
\end{align*} %]]></script>

<p align="justify">This works fine, but for a trajectory $\tau = (s_{0}, a_{0}, ..., s_{T-1}, a_{T-1})$, we might not get a reward signal until the very end, making it incredible difficult to determine which actions in that trajectory were actually influential in leading to that final (hopefully good) reward. Essentially, vanilla policy gradients is very sample inefficient. One way we can deal with this, is by replacing the $R(\tau)$ term with something that incorporates both state and action pairs at each time step. The Q value does this!</p>

<script type="math/tex; mode=display">Q(s_{t}, a_{t}) = \mathbb{E}_{s_{t}, a_{t}, ..., s_{T-1}, a_{T-1}}\Big[\sum_{t'=t}^{T-1}r_{t'}\Big]</script>

<p align="justify">Recall that $Q(s, a)$ is the expected future reward of taking action $a$ in state $s$. Of course we can also discount the reward by $\gamma$.</p>

<script type="math/tex; mode=display">\mathbb{E}_{s_{t}, a_{t}, ..., s_{T-1}, a_{T-1}}\Big[\sum_{t'=t}^{T-1}\gamma^{t' - t}r_{t'}\Big]</script>

<p align="justify">There's just one issue; how do we actually calculate this Q value? Well we can use a neural network parameterized by some $w$ to estimate the Q values. This network is known as the "critic" in actor critic. We call this form of actor critic "Q actor critic".</p>

<center>
  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
    <figure class="figure">
        <img src="/assets/A2C-PPO/actor-critic.png" />
        <figcaption class="figure-caption text-center">Image Credit: Chris Yoon's "Understanding Actor Critic Methods and A2C" medium post</figcaption>
      </figure>   
  </div>
</center>

<h3 id="advantage-actor-critic">Advantage Actor Critic</h3>

<p align="justify">
Q actor critic still suffers from high variance during training in practice, causing slow convergence. One thing we can do to reduce this variance is to define the advantage function.</p>

<script type="math/tex; mode=display">A(s_{t}, a_{t}) = Q(s_{t}, a_{t}) - V(s_{t})</script>

<p align="justify">One intuitive way of thinking about why this decreases the variance is the following: The Q function tells us the expected future reward of being in state $s_{t}$ and taking action $a_{t}$, following some policy $\pi$. The value function tells us the expected future reward of being in state $s_{t}$ and following policy $\pi$. So in a sense, we're taking $Q(s_{t}, a_{t})$, which has high variance, and subtracting the value of $s_{t}$. The policy $\pi$ might tell us that action $a^{1}$ is best to take in $s_{t}$. Some actions are better, some actions are worse. Consequentially, some Q values are better and some are worse, depending on the action. But by subtracting $V(s_{t})$, we get advantage values $A(s_{t}, a_{t})$ that are closer together. Recall the Bellman equation.</p>

<script type="math/tex; mode=display">Q(s_{t}, a_{t}) = r_{t} + \gamma\mathbb{E}[V(s_{t+1})]</script>

<p align="justify">We can use this to substitute $Q(s_{t}, a_{t})$ in the advantage calculation.</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
A(s_{t}, s_{t}) &= Q(s_{t}, a_{t}) - V(s_{t}) \\
&= r_{t} + \gamma V(s_{t+1}) - V(s_{t})
\end{align*} %]]></script>

<p align="justify">Now instead of using a neural network to estimate the Q function, we use it to estimate the value function $V(\cdot)$.</p>

<h3 id="proximal-policy-optimization">Proximal Policy Optimization</h3>

<p align="justify">Proximal Policy Optimization (PPO) improve further upon Advantage Actor Critic (A2C).</p>


  </div><a class="u-url" href="/unfinished_guides/2020-04-27-a2c-ppo.html" hidden></a>
</article>
<!-- FOOTER -->
<footer class="container-fluid footer text-center align-items-center justify-content-center">
    <section class="container-fluid px-0 text-center align-items-center justify-content-center pink-bg">
        <h3 class="mb-4">Stay Informed!</h3>
        <!-- <form action="emails.php">
            <input type="text" placeholder="Email Address" name="mail" required="">
            <input type="submit" value="Submit">
        </form> -->
        <a href="https://forms.gle/HQpw1VeFUPN8uki4A" target="_">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Join our mailing list!</button>
        </a>
    </section>
    <section class="container-fluid px-0 text-center align-items-center justify-content-center row">
        <!-- <div class="col-md-2 mx-0 align-items-center justify-content-center">
            <h5 class="font-weight-bold text-uppercase mt-5 mb-4">About Us</h5>
            <ul class="list-unstyled">
                <li>
                    <a href="about.html" class="lead">Our Mission</a>
                </li>
                <li>
                    <a href="committees.html" class="lead">Our Team</a>
                </li>
            </ul>
        </div> -->
        <!-- <div class="col-md-2 mx-0 align-items-center justify-content-center">
            <h5 class="font-weight-bold text-uppercase mt-5 mb-4">Impact</h5>
            <ul class="list-unstyled">
                <li>
                    <a href="about.html#about-press" class="lead">Press</a>
                </li>
                <li>
                    <a href="https://sites.google.com/umich.edu/cskickstart/home" class="lead" target="_">Sister Program</a>
                </li>
            </ul>
        </div> -->
        <div class="col-md-2 mx-0 align-items-center justify-content-center">
            <h5 class="font-weight-bold text-uppercase mt-5 mb-4">Our Program</h5>
            <ul class="list-unstyled">
                <li>
                    <a href="/incoming_new.html" class="lead">Apply</a>
                </li>
                <li>
                    <a href="/about.html" class="lead">Learn More</a>
                </li>
            </ul>
        </div>
        <!-- <div class="col-md-2 mx-0 align-items-center justify-content-center">
            <h5 class="font-weight-bold text-uppercase mt-5 mb-4">Get Involved</h5>
            <ul class="list-unstyled">
                <li>
                    <a href="current_members.html" class="lead">Current Members</a>
                </li>
                <li>
                    <a href="sponsors.html" class="lead">Support Us</a>
                </li>
            </ul>
        </div> -->

        <div class="col-md-3 mx-0 align-items-center justify-content-center" id="social-hosting">
            <div id="social-media">
                <!-- <a class="social-logo" href="https://www.facebook.com/CS.KickStart" target="_"><img src="imgs/facebook.svg"></a> -->
                <a class="social-logo" href="https://www.instagram.com/cs.fractal.ai/" target="_"><img src="/imgs/instagram.svg"></a>
                <!-- <a class="social-logo" href="https://medium.com/@cskickstart" target="_"><img src="imgs/medium.svg"></a> -->
                <!-- <a class="social-logo" href="https://twitter.com/kickstartcs" target="_"><img src="imgs/twitter.svg"></a> -->
            </div>
        </div>
    </section>
    <br><br>
</footer></body>

</html>
